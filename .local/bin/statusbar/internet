#!/bin/sh
# If provided with any input it will show the wifi by percentage, otherwise it will be shown by a corresponding icon.
# Show wifi 󰤨 and percent strength or 󰤯 if none.
# Show 󰌘 if connected to ethernet or 󰌙 if none.
# Show 󰕓 for USB intefaces
# Show 󰌆 if there is a tunnel or if a vpn word is found in /etc/resolv.conf

case $BLOCK_BUTTON in
    1) terminal -e nmtui; pkill -RTMIN+4 dwmblocks ;;
    3) notify-send "󰖈 Internet module" "\- Click to connect
󰤮: no wifi connection
󰤨: wifi connection
󰌙: no ethernet
󰌘: ethernet working
󰕓: USB interface
󰌆: VPN is active
" ;;
    6) editor "$0" ;;
esac

case "$(cat /sys/class/net/w*/operstate 2>/dev/null)" in
    down) wifiicon="󰤮" ;;
    up)
        percent="$(awk '/^\s*w/ { print int($3 * 100 / 70) }' /proc/net/wireless)"
        [ -n "$1" ] && wifiicon="󰤨$percent%" ||
            if [ "$percent" -gt 80 ] ;then
                wifiicon="󰤨"
            elif [ "$percent" -gt 60 ] ;then
                wifiicon="󰤥"
            elif [ "$percent" -gt 40 ] ;then
                wifiicon="󰤢"
            elif [ "$percent" -gt 20 ] ;then
                wifiicon="󰤟"
            else
                wifiicon="󰤯"
            fi
    ;;
esac

vpn="$(printf "%s%s" "$(cat /etc/resolv.conf | grep -i vpn)" "$(cat /sys/class/net/tun*/operstate 2>/dev/null)" | sed "s/.*/󰌆 /")"

printf "%s%s" "$vpn" "$wifiicon"

for dev in /sys/class/net/e* ;do
    if grep -q usb < "$dev/device/uevent" ;then
        printf " %s" "󰕓"
    else
        printf " %s" "$(sed "s/down/󰌙/;s/up/󰌘/" "$dev/operstate" 2>/dev/null)"
    fi
done
printf "\n"
